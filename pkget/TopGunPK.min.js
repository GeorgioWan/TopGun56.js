function SetMarkers(a,b,c){var d,e,g,h,f=0,i="Y";$.each(b.pk123,function(b,j){if("78787878"!=j.d8&&"^^^^^"!=j.d9&&(_g=j.d9.split("^"),(parseInt(j.d7)>=gStar||_g[0]||_g[1]||_g[2])&&parseInt(_g[5])>=gIV||131===parseInt(j.d1)||143===parseInt(j.d1)||149===parseInt(j.d1))){if(i="Y",h=new google.maps.LatLng(j.d4,j.d5),0<markers.length)for(var k=0;k<markers.length;k++)if(j.d3==markers[k].getTitle()&&h.lat()==markers[k].getPosition().lat()&&h.lng()==markers[k].getPosition().lng()){i="N";break}if("Y"==i){switch(d="",e=0,g=right("00"+j.d1,3),"^^^^^"!=j.d9?(k=j.d9.split("^"),f=parseInt(k[5])):f=0,j.d7){case"5":80<=f?(d="/images/blue_l/"+g+"_l.png",e=parseInt("6"+g)):(d="/images/"+g+".png",e=parseInt("5"+g));break;case"3":"004"==g?85<=f?(d="/images/blue_m/"+g+"_m.png",e=parseInt("4"+g)):(d="/images/mm/"+g+".png",e=parseInt("3"+g)):90<=f?(d="/images/blue_m/"+g+"_m.png",e=parseInt("4"+g)):(d="/images/mm/"+g+".png",e=parseInt("3"+g));break;case"1":"001"==g||"007"==g?85<=f?(d="/images/blue_s/"+g+"_s.png",e=parseInt("2"+g)):(d="/images/ss/"+g+".png",e=parseInt(g)):95<=f?(d="/images/blue_s/"+g+"_s.png",e=parseInt("2"+g)):(d="/images/ss/"+g+".png",e=parseInt(g));break;default:d="/images/ss/"+g+".png",e=parseInt(g)}if(k=new google.maps.Marker({text:pkms.pkms[j.d1].pokemon_name_zhtw,position:h,map:a,icon:d,title:j.d3,zIndex:e,iv:f}),google.maps.event.addListener(k,"click",function(b,d){return function(){var d=0;isNaN(parseInt(j.d3))||(d=new Date,myEndTime=new Date(parseInt(j.d3)),d=d.dateDiff("s",myEndTime),0>d&&(d=0,b.setMap(null))),0<d&&(c.setContent(Get_infowindow(j,formatSecond(d))),isNaN(parseInt(j.d3))||getSecs(b),c.open(a,b),clicktype="click",google.maps.event.addListener(a,"click",function(){c.close()}))}}(k,b)),navigator.userAgent.match(/android/i)||navigator.userAgent.match(/(iphone|ipod|ipad);?/i)||(google.maps.event.addListener(k,"mouseover",function(b,d){return function(){if(""==clicktype){clearTimeout(myTimer);var d=0;isNaN(parseInt(j.d3))||(d=new Date,myEndTime=new Date(parseInt(j.d3)),d=d.dateDiff("s",myEndTime),0>d&&(d=0,b.setMap(null))),0<d&&(c.setContent(Get_infowindow(j,formatSecond(d))),isNaN(parseInt(j.d3))||getSecs(b),c.open(a,b),clicktype="mouseover")}}}(k,b)),google.maps.event.addListener(k,"mouseout",function(a,b){return function(){"mouseover"==clicktype&&(clicktype="",c.close())}}(k,b))),google.maps.event.addListener(c,"closeclick",function(){"click"==clicktype&&(clicktype="")}),0==sh&&lookLat&&lookLng&&lookLat==j.d4&&lookLng==j.d5){var l=0;isNaN(parseInt(j.d3))||(l=new Date,myEndTime=new Date(parseInt(j.d3)),l=l.dateDiff("s",myEndTime),0>l&&(l=0,k.setMap(null))),0<l&&(c.setContent(Get_infowindow(j,formatSecond(l))),isNaN(parseInt(j.d3))||getSecs(k),c.open(a,k)),sh=1}markers.push(k)}}})}function Get_infowindow(a,b){var c;if(!isNaN(parseInt(a.d3))){var d=a.d9.split("^"),e=getpkskByID(parseInt(d[3]))[0].Name==gArrBestMove[parseInt(a.d1)][0]?"&#9757":"",f=getpkskByID(parseInt(d[4]))[0].Name==gArrBestMove[parseInt(a.d1)][1]?"&#9757":"";parseInt(a.d3),c="240";var j,g=pkms.pkms[a.d1].pokemon_name,h=pkms.pkms[a.d1].pokemon_name_zhtw,i=right("00"+a.d1,3),k=0;switch("^^^^^"!=a.d9?(j=a.d9.split("^"),j=parseInt(j[5])):j=0,a.d7){case"5":80<=j&&(k=1);break;case"3":"004"==i?85<=j&&(k=1):90<=j&&(k=1);break;case"1":"001"==i||"007"==i?85<=j&&(k=1):95<=j&&(k=1);break;default:k=0}var i=1==k?"/images/blue_l/"+i+"_l.png":"/images/"+i+".png",l="",m="";return"^^^^^"!=a.d9&&(j=a.d9.split("^"),""!=j[5]&&"-1"!=j[5]&&(m=1==k?m+("<span><b>IV</b>：<font color=red>"+j[5]+" %</font></span><br>"):m+("<span><b>IV</b>："+j[5]+" %</span><br>"),m+="<span><b>攻 / 防 / 體</b>："+j[0]+" / "+j[1]+" / "+j[2]+"</span><br>",l+="<span><b>普通技能</b>："+getpkskByID(j[3])[0].NameCH+"("+getpkskByID(j[3])[0].Name+") "+e+"</span><br><span><b>集氣技能</b>："+getpkskByID(j[4])[0].NameCH+"("+getpkskByID(j[4])[0].Name+") "+f+"</span><br>")),""==m&&(c="200"),c='<div style="float:left;width:75px;margin-top: -3px;padding-right: 5px;"><img src="'+i+'" title="'+h+'" alt="'+h+'" style="width:65px;" /></div><div style="width:'+c+'px;white-space: nowrap;padding-top:3px;">\t<span style="color:#335EA4"><b>'+h+"</b>("+g+')</span><br>\t<span ><b>剩餘</b>：<span id="countdown">'+b+"</span></span><br>"+m+'<div style="float: left; width: '+c+'px; white-space: nowrap; padding-top: 3px;">'+l,c=navigator.userAgent.match(/android/i)||navigator.userAgent.match(/(iphone|ipod|ipad);?/i)?c+('<span>\t<a href="javascript:void(0);" onclick=lineshare("'+h+'","?lat='+a.d4+"&lng="+a.d5+'");><img src="https://media.line.me/img/button/zh-hant/84x20.png" width="84" alt="用LINE傳送" /></a></span><span>&nbsp;</span><span><a href="javascript:void(0);" onclick=Navshare("'+a.d4+","+a.d5+'");><img src="images/NavTo.png" width="84" alt="導航至此地" /></a></span>'):c+('<span><a href="javascript:void(0);" onclick=Navshare("'+a.d4+","+a.d5+'");><img src="images/NavTo_w.png" width="84" alt="用Gmap開啟" /></a></span>'),c+"</div>"}}function findBestPokemon(){$.ajax({url:md("pkm333"),async:!0,dataType:"JSON",success:function(a){a&&("error"==a.pk123[0].d1?alert(a.pk123[0].d2):"error2"!=a.pk123[0].d1&&("out"==a.pk123[0].d1?alert(a.pk123[0].d2):SendEmailIfGoodPokemon(map,a,infowindow)))},error:function(a){}}),setTimeout(findBestPokemon,5e3)}function SendEmailIfGoodPokemon(a,b,c){var d=new Array;$.each(b.pk123,function(a,b){var c=new Object,e=b.d9.split("^"),f=parseFloat(e[5]);if(f=f.toPrecision(4),(parseInt(b.d7)>=gStar||e[0]||e[1]||e[2])&&f>=gIV||131===parseInt(b.d1)||143===parseInt(b.d1)||149===parseInt(b.d1)){var g=getpkskByID(parseInt(e[3]))[0].Name==gArrBestMove[parseInt(b.d1)][0]?"★★★":"",h=getpkskByID(parseInt(e[4]))[0].Name==gArrBestMove[parseInt(b.d1)][1]?"★★★":"";c.isSended=isSended(b),c.index=parseInt(b.d1),c.name=pkms.pkms[parseInt(b.d1)].pokemon_name+" ("+pkms.pkms[parseInt(b.d1)].pokemon_name_zhtw+") ",c.i=parseInt(b.d1),c.s=parseInt(b.d7),c.n=parseInt(b.d4),c.iv=f,c.t=formatSecond((new Date).dateDiff("s",new Date(parseInt(b.d3)))),c.iv_s=f+"% ("+parseInt(e[0])+"/"+parseInt(e[1])+"/"+parseInt(e[2])+")",c.m1=getpkskByID(parseInt(e[3]))[0].Name+" ( "+getpkskByID(parseInt(e[3]))[0].NameCH+") "+g,c.m2=getpkskByID(parseInt(e[4]))[0].Name+" ( "+getpkskByID(parseInt(e[4]))[0].NameCH+") "+h,d.push(c)}}),d.length&&doSendNotif(d),gLastNotifPokemon=d,on_idle()}function isSended(a){var b=!1;return gLastNotifPokemon.forEach((c=>{if(c.index===parseInt(a.d1)&&c.n===parseInt(a.d4))return b=!0,!0})),b}function doSendNotif(a){"granted"!==Notification.permission?Notification.requestPermission():a.forEach(((a,b)=>{if(a.isSended===!1){var c=new Notification("【大家找寶貝】發現超猛 Pokemon",{icon:"https://pkget.com/images/"+right("00"+a.index,3)+".png",body:a.name+"\n- iv: "+a.iv_s+"\n- "+a.m1+"\n- "+a.m2+"\n距通知後 "+a.t+" 即將消失"});c.onclick=function(){window.focus()},setTimeout(function(){c.close()},2e4)}}))}var ctl,ig,sp,el;ctl=document.createElement("span"),ig=document.createElement("div"),ig.className="input-group input-group-sm",ig.style.position="absolute",ig.style.bottom="70px",ig.style.width="110px",sp=document.createElement("span"),sp.id="addon-iv",sp.className="input-group-addon",sp.innerHTML="IV",el=document.createElement("input"),el.className="form-control",el.id="input-iv",el.placeholder="IV",el.value="90",el.setAttribute("aria-describedby","addon-iv"),ig.appendChild(sp),ig.appendChild(el),ctl.appendChild(ig),ig=document.createElement("div"),ig.className="input-group input-group-sm",ig.style.position="absolute",ig.style.bottom="40px",ig.style.width="110px",sp=document.createElement("span"),sp.id="addon-star",sp.className="input-group-addon",sp.innerHTML='<span class="glyphicon glyphicon-star"></span>',el=document.createElement("input"),el.className="form-control",el.id="input-star",el.placeholder="STAR",el.value="1",el.setAttribute("aria-describedby","addon-star"),ig.appendChild(sp),ig.appendChild(el),ctl.appendChild(ig),el=document.createElement("button"),el.className="btn btn-sm btn-success",el.id="get-custom",el.style.position="absolute",el.style.bottom="10px",el.style.width="110px",sp=document.createElement("span"),sp.className="glyphicon glyphicon-play",el.appendChild(sp),ctl.appendChild(el),map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(ctl);var gStar=1,gIV=90;$(document).ready(function(){google.maps.event.addListener(map,"idle",on_idle),checkMarkerTimeout(),getLocation(),$("#get-custom").on("click",function(){gStar=parseInt($("#input-star")[0].value),gIV=parseInt($("#input-iv")[0].value);try{for(var a=markers.length-1;a>=0;a--)(void 0===markers[a].iv||markers[a].iv<gIV&&"卡比獸"!==markers[a].text&&"乘龍"!==markers[a].text&&"快龍"!==parseInt(k.d1))&&(markers[a].setMap(null),markers.splice(a,1))}catch(a){}on_idle()}),setTimeout(findBestPokemon,5e3)});var gLastNotifPokemon=new Array,gArrBestMove=[["none","none"],["Vine Whip","Sludge Bomb"],["Vine Whip","Solar Beam"],["Vine Whip","Solar Beam"],["Scratch","Flamethrower"],["Scratch","Flamethrower"],["Wing Attack","Fire Blast"],["Bubble","Aqua Tail"],["Water Gun","Hydro Pump"],["Water Gun","Hydro Pump"],["Bug Bite","Struggle"],["Bug Bite","Struggle"],["Bug Bite","Bug Buzz"],["Bug Bite","Struggle"],["Bug Bite","Struggle"],["Poison Jab","Sludge Bomb"],["Tackle","Aerial Ace"],["Wing Attack","Aerial Ace"],["Wing Attack","Hurricane"],["Tackle","Body Slam"],["Bite","Hyper Beam"],["Peck","Drill Peck"],["Steel Wing","Drill Run"],["Poison Sting","Gunk Shot"],["Bite","Gunk Shot"],["Thunder Shock","Thunder"],["Spark","Thunder"],["Mud Shot","Rock Slide"],["Mud Shot","Earthquake"],["Poison Sting","Sludge Bomb"],["Poison Sting","Sludge Bomb"],["Poison Jab","Earthquake"],["Poison Sting","Sludge Bomb"],["Poison Jab","Sludge Bomb"],["Poison Jab","Earthquake"],["Pound","Moonblast"],["Pound","Moonblast"],["Ember","Body Slam"],["Ember","Fire Blast"],["Pound","Body Slam"],["Pound","Hyper Beam"],["Bite","Sludge Bomb"],["Wing Attack","Poison Fang"],["Razor Leaf","Sludge Bomb"],["Razor Leaf","Sludge Bomb"],["Razor Leaf","Solar Beam"],["Bug Bite","Seed Bomb"],["Bug Bite","Solar Beam"],["Bug Bite","Signal Beam"],["Bug Bite","Bug Buzz"],["Mud Shot","Dig"],["Mud Shot","Earthquake"],["Scratch","Body Slam"],["Scratch","Play Rough"],["Water Gun","Cross Chop"],["Water Gun","Hydro Pump"],["Scratch","Cross Chop"],["Low Kick","Cross Chop"],["Bite","Body Slam"],["Fire Fang","Fire Blast"],["Bubble","Body Slam"],["Bubble","Scald"],["Bubble","Hydro Pump"],["Zen Headbutt","Psyshock"],["Psycho Cut","Shadow Ball"],["Psycho Cut","Psychic"],["Low Kick","Cross Chop"],["Low Kick","Cross Chop"],["Karate Chop","Cross Chop"],["Vine Whip","Power Whip"],["Razor Leaf","Power Whip"],["Razor Leaf","Solar Beam"],["Bubble","Water Pulse"],["Poison Jab","Hydro Pump"],["Rock Throw","Rock Slide"],["Mud Shot","Stone Edge"],["Mud Shot","Stone Edge"],["Ember","Fire Blast"],["Ember","Fire Blast"],["Water Gun","Psychic"],["Water Gun","Psychic"],["Spark","Thunderbolt"],["Spark","Flash Cannon"],["Cut","Leaf Blade"],["Peck","Drill Peck"],["Feint Attack","Drill Peck"],["Water Gun","Aqua Tail"],["Frost Breath","Blizzard"],["Acid","Sludge Bomb"],["Poison Jab","Sludge Bomb"],["Tackle","Water Pulse"],["Frost Breath","Blizzard"],["Lick","Sludge Bomb"],["Shadow Claw","Sludge Bomb"],["Shadow Claw","Sludge Wave"],["Rock Throw","Stone Edge"],["Pound","Psychic"],["Zen Headbutt","Psychic"],["Bubble","Water Pulse"],["Metal Claw","X Scissor"],["Spark","Thunderbolt"],["Spark","Thunderbolt"],["Confusion","Psychic"],["Zen Headbutt","Solar Beam"],["Mud Slap","Bone Club"],["Mud Slap","Earthquake"],["Rock Smash","Stone Edge"],["Rock Smash","Brick Break"],["Zen Headbutt","Hyper Beam"],["Acid","Sludge Bomb"],["Acid","Sludge Bomb"],["Mud Slap","Stomp"],["Mud Slap","Stone Edge"],["Pound","Psychic"],["Vine Whip","Power Whip"],["Mud Slap","Earthquake"],["Water Gun","Dragon Pulse"],["Water Gun","Hydro Pump"],["Mud Shot","Aqua Tail"],["Poison Jab","Megahorn"],["Water Gun","Power Gem"],["Water Gun","Hydro Pump"],["Zen Headbutt","Psychic"],["Steel Wing","Bug Buzz"],["Frost Breath","Psyshock"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Rock Smash","X Scissor"],["Tackle","Earthquake"],["Splash","Struggle"],["Bite","Hydro Pump"],["Frost Breath","Blizzard"],["Pound","Struggle"],["Tackle","Body Slam"],["Water Gun","Hydro Pump"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Tackle","Signal Beam"],["Water Gun","Brine"],["Water Gun","Hydro Pump"],["Scratch","Aqua Jet"],["Mud Shot","Stone Edge"],["Bite","Hyper Beam"],["Zen Headbutt","Body Slam"],["Frost Breath","Blizzard"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Dragon Breath","Aqua Tail"],["Dragon Breath","Dragon Pulse"],["Dragon Breath","Dragon Claw"],["Psycho Cut","Psychic"],["Pound","Hurricane"]];window.addEventListener("load",function(){Notification&&"granted"!==Notification.permission&&Notification.requestPermission(function(a){Notification.permission!==a&&(Notification.permission=a)})});