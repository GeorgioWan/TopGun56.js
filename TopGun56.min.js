function SetMarkers(a,b,c){var d,e,f="Y";$.each(b.pokemons,function(b,g){if((g.s>=star||g.v[0]||g.v[1]||g.v[2])&&(g.v[0]+g.v[1]+g.v[2])/45*100>=iv||131===g.i||143===g.i||149===g.i){if(f="Y",e=new google.maps.LatLng(g.a,g.n),0<markers.length)for(var h=0;h<markers.length;h++)if(g.t==markers[h].time&&e.lat()==markers[h].getPosition().lat()&&e.lng()==markers[h].getPosition().lng()){f="N";break}"Y"==f&&(d=(g.v[0]||g.v[1]||g.v[2])&&(g.v[0]+g.v[1]+g.v[2])/45*100>80?"https://s3-ap-northeast-1.amazonaws.com/download.poke5566.com/photos/"+right("00"+g.i,3)+".png":g.s>=3?"https://s3-ap-northeast-1.amazonaws.com/download.poke5566.com/images/"+right("00"+g.i,3)+".png":"https://s3-ap-northeast-1.amazonaws.com/download.poke5566.com/icons/"+g.i+".png",marker=new google.maps.Marker({text:pokemonEn[g.i],position:e,map:a,icon:d,time:g.t.toString(),zIndex:g.s,iv:(g.v[0]+g.v[1]+g.v[2])/45*100}),google.maps.event.addListener(marker,"click",function(b,d){return function(){var d=0;isNaN(parseInt(g.t))||(d=new Date,myEndTime=new Date(parseInt(g.t)),d=d.dateDiff("s",myEndTime),0>d&&(d=0,b.setMap(null))),0<d&&(c.setContent(Get_infowindow(g,formatSecond(d))),isNaN(parseInt(g.t))||getSecs(b),c.open(a,b),clicktype="click")}}(marker,b)),navigator.userAgent.match(/android/i)||navigator.userAgent.match(/(iphone|ipod);?/i)||(google.maps.event.addListener(marker,"mouseover",function(b,d){return function(){if(""==clicktype){clearTimeout(myTimer);var d=0;isNaN(parseInt(g.t))||(d=new Date,myEndTime=new Date(parseInt(g.t)),d=d.dateDiff("s",myEndTime),0>d&&(d=0,b.setMap(null))),0<d&&(c.setContent(Get_infowindow(g,formatSecond(d))),isNaN(parseInt(g.t))||getSecs(b),c.open(a,b),clicktype="mouseover")}}}(marker,b)),google.maps.event.addListener(marker,"mouseout",function(a,b){return function(){"mouseover"==clicktype&&(clicktype="",c.close())}}(marker,b))),google.maps.event.addListener(c,"closeclick",function(){"click"==clicktype&&(clicktype="")}),0==sh&&lookLat&&lookLng&&lookLat==g.a&&lookLng==g.n&&(h=0,isNaN(parseInt(g.t))||(h=new Date,myEndTime=new Date(parseInt(g.t)),h=h.dateDiff("s",myEndTime),0>h&&(h=0,marker.setMap(null))),0<h&&(c.setContent(Get_infowindow(g,formatSecond(h))),isNaN(parseInt(g.t))||getSecs(marker),c.open(a,marker)),sh=1),markers.push(marker))}})}function Get_infowindow(a,b){var c="";if(!isNaN(parseInt(a.t))){var f,d=pokemonMoves[a.m[0]].name==gArrBestMove[a.i][0]?"&#9757":"",e=pokemonMoves[a.m[1]].name==gArrBestMove[a.i][1]?"&#9757":"",g=(new Date(parseInt(a.t)),"https://maps.google.com/?q="+a.a+","+a.n),h="https://poke5566.com/?lat="+a.a+"&lng="+a.n,i="【寶可五六雷達】發現【"+pokemonZhTw[pokemonEn[a.i]]+"】囉！剩下"+b+"，消失時間"+new Date(a.t).getHours()+"時"+new Date(a.t).getMinutes()+"分，快來看看他在哪裡？";f=navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("Android")!=-1?"http://line.me/R/msg/text/?"+i+h+"&referral=line":"https://www.facebook.com/dialog/share?app_id=1680267198959582&quote="+i+"&href="+encodeURIComponent(h+"&referral=facebook");var j;a.v[0]||a.v[1]||a.v[2]||a.m[0]||a.m[1]?(j='<span class="myfont_line">IV <strong>'+((a.v[0]+a.v[1]+a.v[2])/45*100).toFixed(2)+"% </strong>("+String(a.v[0])+"/"+String(a.v[1])+"/"+String(a.v[2])+")</span><br>",j+='<span class="myfont_line"><strong>'+pokemonMoves[a.m[0]].name+" </strong> ("+pokemonMovesZh[a.m[0]].zh+")"+d+'</span>&nbsp;<span class="pull-right">'+pokemonMoves[a.m[0]].dps+" dps</span><br>",j+='<span class="myfont_line"><strong>'+pokemonMoves[a.m[1]].name+" </strong> ("+pokemonMovesZh[a.m[1]].zh+")"+e+'</span>&nbsp;<span class="pull-right">'+pokemonMoves[a.m[1]].dps+" dps</span><br>"):j="",c="<div class=myfont_title_m><span class=myfont_line><b>"+pokemonEn[a.i]+"</b>&nbsp;("+pokemonZhTw[pokemonEn[a.i]]+')</span><span class="pull-right" style="padding-left: 4px; font-weight: bold"><span id=countdown>'+b+"</span></span><br>",c+=j,c+='<span class="myfont_line">'+parseFloat(a.a.toFixed(10))+", "+parseFloat(a.n.toFixed(10))+"</span></div>",c+='<div style="margin-top: 2px;"><a class="btn btn-primary btn-sm" href="'+g+'" role="button" target="_blank" style="margin-right:5px;">導航&nbsp;&nbsp;<span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span></a>',c+='<a class="btn btn-success btn-sm" href="'+f+'" role="button" target="_blank">分享&nbsp;&nbsp;<span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span></a></div>',c+='<span style="position:absolute; bottom:0; right:0; font-size:10px !important;"><b>poke5566.com</b></span>'}return c}function findBestPokemon(){$.ajax({url:url(),async:!0,dataType:"JSON",success:function(a){a&&a.pokemons.length&&SendEmailIfGoodPokemon(map,a,infowindow)},error:function(a){}}),setTimeout(findBestPokemon,5e3)}function SendEmailIfGoodPokemon(a,b,c){var d=parseInt($.cookie("iv")),e=new Array;$.each(b.pokemons,function(a,b){var c=new Object,f=(b.v[0]+b.v[1]+b.v[2])/45*100;if(f=f.toPrecision(4),(b.s>=star||b.v[0]||b.v[1]||b.v[2])&&f>=d||131===b.i||143===b.i||149===b.i){var g=pokemonMoves[b.m[0]].name==gArrBestMove[b.i][0]?"★★★":"",h=pokemonMoves[b.m[1]].name==gArrBestMove[b.i][1]?"★★★":"";c.isSended=isSended(b),c.index=pokemonEn[b.i],c.i=b.i,c.s=b.s,c.n=b.n,c.iv=f,c.t=formatSecond((new Date).dateDiff("s",new Date(parseInt(b.t)))),c.iv_s=f+"% ("+b.v[0]+"/"+b.v[1]+"/"+b.v[2]+")",c.m1=pokemonMovesZh[b.m[0]].en+" ( "+pokemonMovesZh[b.m[0]].zh+") "+g,c.m2=pokemonMovesZh[b.m[1]].en+" ( "+pokemonMovesZh[b.m[1]].zh+") "+h,e.push(c)}}),e.length&&doSendNotif(e),gLastNotifPokemon=e,get()}function isSended(a){var b=!1;return gLastNotifPokemon.forEach((c=>{if(c.index===pokemonEn[a.i]&&c.n===a.n)return b=!0,!0})),b}function doSendNotif(a){if("granted"!==Notification.permission)Notification.requestPermission();else{a.length;a.forEach(((a,b)=>{if(a.isSended===!1){var c=new Notification("【寶可56】發現超猛 Pokemon！",{icon:a.s>=3?"https://s3-ap-northeast-1.amazonaws.com/download.poke5566.com/images/"+right("00"+a.i,3)+".png":"https://s3-ap-northeast-1.amazonaws.com/download.poke5566.com/icons/"+a.i+".png",body:a.index+" ( "+pokemonZhTw[pokemonEn[a.i]]+" )\n- iv: "+a.iv_s+"\n- "+a.m1+"\n- "+a.m2+"\n距通知後 "+a.t+" 即將消失"});c.onclick=function(){window.focus()},setTimeout(function(){c.close()},2e4)}}))}}var ig,sp,el,_body=document.getElementsByTagName("body")[0];ig=document.createElement("div"),ig.className="input-group",ig.style.position="absolute",ig.style.bottom="10px",ig.style.left="60px",ig.style.width="80px",sp=document.createElement("span"),sp.id="addon-iv",sp.className="input-group-addon",sp.innerHTML="IV",el=document.createElement("input"),el.className="form-control",el.id="input-iv",el.placeholder="IV",el.value=$.cookie("iv")?$.cookie("iv"):"",el.setAttribute("aria-describedby","addon-iv"),ig.appendChild(sp),ig.appendChild(el),_body.appendChild(ig),ig=document.createElement("div"),ig.className="input-group",ig.style.position="absolute",ig.style.bottom="10px",ig.style.left="150px",ig.style.width="80px",sp=document.createElement("span"),sp.id="addon-star",sp.className="input-group-addon",sp.innerHTML='<span class="glyphicon glyphicon-star"></span>',el=document.createElement("input"),el.className="form-control",el.id="input-star",el.placeholder="STAR",el.value=$.cookie("star")?$.cookie("star"):"",el.setAttribute("aria-describedby","addon-star"),ig.appendChild(sp),ig.appendChild(el),_body.appendChild(ig),el=document.createElement("button"),el.className="btn btn-primary",el.id="get-custom",el.style.position="absolute",el.style.bottom="10px",el.style.left="240px",sp=document.createElement("span"),sp.className="glyphicon glyphicon-play",el.appendChild(sp),_body.appendChild(el),$(document).ready(function(){google.maps.event.addListener(map,"idle",get),checkMarkerTimeout(),getLocation(),$("#get-custom").on("click",function(){star=parseInt($("#input-star")[0].value),iv=parseInt($("#input-iv")[0].value),$.cookie("star",star,{path:"/"}),$.cookie("iv",iv,{path:"/"});try{for(var a=markers.length-1;a>=0;a--)markers[a].iv<iv&&(markers[a].setMap(null),markers.splice(a,1))}catch(a){}get()}),setTimeout(findBestPokemon,5e3)});var gLastNotifPokemon=new Array,gArrBestMove=[["none","none"],["Vine Whip","Sludge Bomb"],["Vine Whip","Solar Beam"],["Vine Whip","Solar Beam"],["Scratch","Flamethrower"],["Scratch","Flamethrower"],["Wing Attack","Fire Blast"],["Bubble","Aqua Tail"],["Water Gun","Hydro Pump"],["Water Gun","Hydro Pump"],["Bug Bite","Struggle"],["Bug Bite","Struggle"],["Bug Bite","Bug Buzz"],["Bug Bite","Struggle"],["Bug Bite","Struggle"],["Poison Jab","Sludge Bomb"],["Tackle","Aerial Ace"],["Wing Attack","Aerial Ace"],["Wing Attack","Hurricane"],["Tackle","Body Slam"],["Bite","Hyper Beam"],["Peck","Drill Peck"],["Steel Wing","Drill Run"],["Poison Sting","Gunk Shot"],["Bite","Gunk Shot"],["Thunder Shock","Thunder"],["Spark","Thunder"],["Mud Shot","Rock Slide"],["Mud Shot","Earthquake"],["Poison Sting","Sludge Bomb"],["Poison Sting","Sludge Bomb"],["Poison Jab","Earthquake"],["Poison Sting","Sludge Bomb"],["Poison Jab","Sludge Bomb"],["Poison Jab","Earthquake"],["Pound","Moonblast"],["Pound","Moonblast"],["Ember","Body Slam"],["Ember","Fire Blast"],["Pound","Body Slam"],["Pound","Hyper Beam"],["Bite","Sludge Bomb"],["Wing Attack","Poison Fang"],["Razor Leaf","Sludge Bomb"],["Razor Leaf","Sludge Bomb"],["Razor Leaf","Solar Beam"],["Bug Bite","Seed Bomb"],["Bug Bite","Solar Beam"],["Bug Bite","Signal Beam"],["Bug Bite","Bug Buzz"],["Mud Shot","Dig"],["Mud Shot","Earthquake"],["Scratch","Body Slam"],["Scratch","Play Rough"],["Water Gun","Cross Chop"],["Water Gun","Hydro Pump"],["Scratch","Cross Chop"],["Low Kick","Cross Chop"],["Bite","Body Slam"],["Fire Fang","Fire Blast"],["Bubble","Body Slam"],["Bubble","Scald"],["Bubble","Hydro Pump"],["Zen Headbutt","Psyshock"],["Psycho Cut","Shadow Ball"],["Psycho Cut","Psychic"],["Low Kick","Cross Chop"],["Low Kick","Cross Chop"],["Karate Chop","Cross Chop"],["Vine Whip","Power Whip"],["Razor Leaf","Power Whip"],["Razor Leaf","Solar Beam"],["Bubble","Water Pulse"],["Poison Jab","Hydro Pump"],["Rock Throw","Rock Slide"],["Mud Shot","Stone Edge"],["Mud Shot","Stone Edge"],["Ember","Fire Blast"],["Ember","Fire Blast"],["Water Gun","Psychic"],["Water Gun","Psychic"],["Spark","Thunderbolt"],["Spark","Flash Cannon"],["Cut","Leaf Blade"],["Peck","Drill Peck"],["Feint Attack","Drill Peck"],["Water Gun","Aqua Tail"],["Frost Breath","Blizzard"],["Acid","Sludge Bomb"],["Poison Jab","Sludge Bomb"],["Tackle","Water Pulse"],["Frost Breath","Blizzard"],["Lick","Sludge Bomb"],["Shadow Claw","Sludge Bomb"],["Shadow Claw","Sludge Wave"],["Rock Throw","Stone Edge"],["Pound","Psychic"],["Zen Headbutt","Psychic"],["Bubble","Water Pulse"],["Metal Claw","X Scissor"],["Spark","Thunderbolt"],["Spark","Thunderbolt"],["Confusion","Psychic"],["Zen Headbutt","Solar Beam"],["Mud Slap","Bone Club"],["Mud Slap","Earthquake"],["Rock Smash","Stone Edge"],["Rock Smash","Brick Break"],["Zen Headbutt","Hyper Beam"],["Acid","Sludge Bomb"],["Acid","Sludge Bomb"],["Mud Slap","Stomp"],["Mud Slap","Stone Edge"],["Pound","Psychic"],["Vine Whip","Power Whip"],["Mud Slap","Earthquake"],["Water Gun","Dragon Pulse"],["Water Gun","Hydro Pump"],["Mud Shot","Aqua Tail"],["Poison Jab","Megahorn"],["Water Gun","Power Gem"],["Water Gun","Hydro Pump"],["Zen Headbutt","Psychic"],["Steel Wing","Bug Buzz"],["Frost Breath","Psyshock"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Rock Smash","X Scissor"],["Tackle","Earthquake"],["Splash","Struggle"],["Bite","Hydro Pump"],["Frost Breath","Blizzard"],["Pound","Struggle"],["Tackle","Body Slam"],["Water Gun","Hydro Pump"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Tackle","Signal Beam"],["Water Gun","Brine"],["Water Gun","Hydro Pump"],["Scratch","Aqua Jet"],["Mud Shot","Stone Edge"],["Bite","Hyper Beam"],["Zen Headbutt","Body Slam"],["Frost Breath","Blizzard"],["Thunder Shock","Thunder"],["Ember","Fire Blast"],["Dragon Breath","Aqua Tail"],["Dragon Breath","Dragon Pulse"],["Dragon Breath","Dragon Claw"],["Psycho Cut","Psychic"],["Pound","Hurricane"]];window.addEventListener("load",function(){Notification&&"granted"!==Notification.permission&&Notification.requestPermission(function(a){Notification.permission!==a&&(Notification.permission=a)})});